var ss=Object.defineProperty;var ns=(i,e,t)=>e in i?ss(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var I=(i,e,t)=>(ns(i,typeof e!="symbol"?e+"":e,t),t);import{l as ls,f as Ot,g as is,s as Nt,e as ut,h as os}from"../chunks/lang.Bi2J_BWb.js";import{l as rs,u as as,L as M,A as ae,C as Pt,g as us,b as Mt,d as fs}from"../chunks/db.BShgSK99.js";import{L as Se,e as ye,u as hs,d as cs,g as Yt,f as ds,h as _s,i as gs,j as ps,b as ms}from"../chunks/dialog.C5mKGYyV.js";import{s as me,z as Ve,k as C,n as W,i as f,B as ht,e as w,d as k,f as b,r as h,S as D,_ as ct,t as V,h as Q,l as m,m as H,C as qe,b as j,j as R,p as Qe,q as We,x as q,y as dt,Z as vs,U as Xe,w as bs,W as ws,E as lt,$ as it,T as ks}from"../chunks/scheduler.DK9WmFTb.js";import{S as ve,i as be,t as O,g as Ye,a as U,c as $e,b as ue,d as fe,m as he,e as ce,f as Ls}from"../chunks/index.DcNqul0Z.js";/* empty css                       */import{a as Bt,l as Ut,S as Es}from"../chunks/stats.Zy988s_3.js";import{b as ot}from"../chunks/paths.DAkDvWyj.js";async function Cs({parent:i,fetch:e}){const{db:t}=await i();let s=await ls(t),n=await Se.loadLast(s,t,e),l=await Se.getLessonOptions(n.baseLesson().id,t),o=await rs(t,as)??[];return{config:s,lesson:n,lessonOpts:l,customLessons:o}}const mn=Object.freeze(Object.defineProperty({__proto__:null,load:Cs},Symbol.toStringTag,{value:"Module"}));function qt(i,e,t){const s=i.slice();return s[7]=e[t],s[9]=t,s}function Vt(i){let e,t=ye(i[1]),s=[];for(let n=0;n<t.length;n+=1)s[n]=Qt(qt(i,t,n));return{c(){e=w("span");for(let n=0;n<s.length;n+=1)s[n].c();this.h()},l(n){e=k(n,"SPAN",{class:!0});var l=b(e);for(let o=0;o<s.length;o+=1)s[o].l(l);l.forEach(f),this.h()},h(){h(e,"class","word"),D(e,"active",i[3]),D(e,"success",i[4]),D(e,"error",i[5])},m(n,l){C(n,e,l);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(e,null);i[6](e)},p(n,l){if(l&6){t=ye(n[1]);let o;for(o=0;o<t.length;o+=1){const r=qt(n,t,o);s[o]?s[o].p(r,l):(s[o]=Qt(r),s[o].c(),s[o].m(e,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=t.length}l&8&&D(e,"active",n[3])},d(n){n&&f(e),ct(s,n),i[6](null)}}}function Qt(i){let e,t=i[7]+"",s;return{c(){e=w("span"),s=V(t),this.h()},l(n){e=k(n,"SPAN",{class:!0});var l=b(e);s=Q(l,t),l.forEach(f),this.h()},h(){h(e,"class","letter"),D(e,"incomplete",i[2][i[9]]===M.Incomplete),D(e,"active",i[2][i[9]]===M.Active),D(e,"complete",i[2][i[9]]===M.Complete),D(e,"error",i[2][i[9]]===M.Error)},m(n,l){C(n,e,l),m(e,s)},p(n,l){l&2&&t!==(t=n[7]+"")&&H(s,t),l&4&&D(e,"incomplete",n[2][n[9]]===M.Incomplete),l&4&&D(e,"active",n[2][n[9]]===M.Active),l&4&&D(e,"complete",n[2][n[9]]===M.Complete),l&4&&D(e,"error",n[2][n[9]]===M.Error)},d(n){n&&f(e)}}}function Ss(i){let e,t=i[1].length!==0&&Vt(i);return{c(){t&&t.c(),e=Ve()},l(s){t&&t.l(s),e=Ve()},m(s,n){t&&t.m(s,n),C(s,e,n)},p(s,[n]){s[1].length!==0?t?t.p(s,n):(t=Vt(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:W,o:W,d(s){s&&f(e),t&&t.d(s)}}}function ys(i,e,t){let{word:s}=e,{state:n}=e,{active:l=!1}=e,{span:o=void 0}=e,r=n.every(_=>_===M.Complete),a=n.some(_=>_===M.Error);ht(()=>{});function d(_){qe[_?"unshift":"push"](()=>{o=_,t(0,o)})}return i.$$set=_=>{"word"in _&&t(1,s=_.word),"state"in _&&t(2,n=_.state),"active"in _&&t(3,l=_.active),"span"in _&&t(0,o=_.span)},[o,s,n,l,r,a,d]}class $t extends ve{constructor(e){super(),be(this,e,ys,Ss,me,{word:1,state:2,active:3,span:0})}}function Wt(i){let e,t;return{c(){e=w("span"),t=V(i[0]),this.h()},l(s){e=k(s,"SPAN",{class:!0});var n=b(e);t=Q(n,i[0]),n.forEach(f),this.h()},h(){h(e,"class","word queued")},m(s,n){C(s,e,n),m(e,t)},p(s,n){n&1&&H(t,s[0])},d(s){s&&f(e)}}}function As(i){let e,t=i[0].length!==0&&Wt(i);return{c(){t&&t.c(),e=Ve()},l(s){t&&t.l(s),e=Ve()},m(s,n){t&&t.m(s,n),C(s,e,n)},p(s,[n]){s[0].length!==0?t?t.p(s,n):(t=Wt(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:W,o:W,d(s){s&&f(e),t&&t.d(s)}}}function Ds(i,e,t){let{word:s}=e;return i.$$set=n=>{"word"in n&&t(0,s=n.word)},[s]}class Ts extends ve{constructor(e){super(),be(this,e,Ds,As,me,{word:0})}}function Is(i){let e,t=i[0].statsDialogDuration+"",s,n,l,o,r=Ot(i[2],i[1])+"",a,d;return{c(){e=w("div"),s=V(t),n=j(),l=w("div"),o=w("time"),a=V(r),this.h()},l(_){e=k(_,"DIV",{class:!0});var v=b(e);s=Q(v,t),v.forEach(f),n=R(_),l=k(_,"DIV",{class:!0});var E=b(l);o=k(E,"TIME",{datetime:!0});var S=b(o);a=Q(S,r),S.forEach(f),E.forEach(f),this.h()},h(){h(e,"class","svelte-1jf38p4"),h(o,"datetime",d=i[1]+"ms"),h(l,"class","svelte-1jf38p4")},m(_,v){C(_,e,v),m(e,s),C(_,n,v),C(_,l,v),m(l,o),m(o,a)},p(_,[v]){v&1&&t!==(t=_[0].statsDialogDuration+"")&&H(s,t),v&2&&r!==(r=Ot(_[2],_[1])+"")&&H(a,r),v&2&&d!==(d=_[1]+"ms")&&h(o,"datetime",d)},i:W,o:W,d(_){_&&(f(e),f(n),f(l))}}}function Os(i,e,t){let{stats:s}=e,{lang:n}=e,l=0,o=is(n);return setInterval(()=>{s.started!==void 0&&t(1,l=Math.round(s.duration+performance.now()-s.started))},1e3),i.$$set=r=>{"stats"in r&&t(3,s=r.stats),"lang"in r&&t(0,n=r.lang)},[n,l,o,s]}class Ns extends ve{constructor(e){super(),be(this,e,Os,Is,me,{stats:3,lang:0})}}function Ps(i){let e,t;return{c(){e=Qe("svg"),t=Qe("path"),this.h()},l(s){e=We(s,"svg",{viewBox:!0,xmlns:!0});var n=b(e);t=We(n,"path",{d:!0}),b(t).forEach(f),n.forEach(f),this.h()},h(){h(t,"d","M 222.567 106.961 Q 250.075 51.945 277.583 106.961 L 405.955 363.705 Q 433.463 418.721 378.447 418.721 L 121.703 418.721 Q 66.687 418.721 94.195 363.705 Z"),h(e,"viewBox","0 0 500 500"),h(e,"xmlns","http://www.w3.org/2000/svg")},m(s,n){C(s,e,n),m(e,t)},p:W,i:W,o:W,d(s){s&&f(e)}}}class xt extends ve{constructor(e){super(),be(this,e,null,Ps,me,{})}}function zt(i,e,t){const s=i.slice();return s[13]=e[t],s}function jt(i,e,t){const s=i.slice();return s[13]=e[t],s}function Rt(i){let e,t,s,n,l,o,r;return t=new xt({}),{c(){e=w("button"),ue(t.$$.fragment),this.h()},l(a){e=k(a,"BUTTON",{class:!0,type:!0,title:!0});var d=b(e);fe(t.$$.fragment,d),d.forEach(f),this.h()},h(){h(e,"class","prev fade-icon svelte-gbziy8"),h(e,"type","button"),e.disabled=s=i[5]===null,h(e,"title",n=i[3].seriesPrevLesson),D(e,"done",i[1])},m(a,d){C(a,e,d),he(t,e,null),l=!0,o||(r=q(e,"click",i[8]),o=!0)},p(a,d){(!l||d&32&&s!==(s=a[5]===null))&&(e.disabled=s),(!l||d&8&&n!==(n=a[3].seriesPrevLesson))&&h(e,"title",n),(!l||d&2)&&D(e,"done",a[1])},i(a){l||(O(t.$$.fragment,a),l=!0)},o(a){U(t.$$.fragment,a),l=!1},d(a){a&&f(e),ce(t),o=!1,r()}}}function Ht(i){let e,t,s=ye(i[4].lessons),n=[];for(let l=0;l<s.length;l+=1)n[l]=Kt(jt(i,s,l));return{c(){e=w("optgroup");for(let l=0;l<n.length;l+=1)n[l].c();this.h()},l(l){e=k(l,"OPTGROUP",{label:!0});var o=b(e);for(let r=0;r<n.length;r+=1)n[r].l(o);o.forEach(f),this.h()},h(){h(e,"label",t=i[4].name)},m(l,o){C(l,e,o);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null)},p(l,o){if(o&17){s=ye(l[4].lessons);let r;for(r=0;r<s.length;r+=1){const a=jt(l,s,r);n[r]?n[r].p(a,o):(n[r]=Kt(a),n[r].c(),n[r].m(e,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=s.length}o&16&&t!==(t=l[4].name)&&h(e,"label",t)},d(l){l&&f(e),ct(n,l)}}}function Kt(i){var o;let e,t=((o=Nt.get(i[13]))==null?void 0:o.name)+"",s,n,l;return{c(){e=w("option"),s=V(t),this.h()},l(r){e=k(r,"OPTION",{});var a=b(e);s=Q(a,t),a.forEach(f),this.h()},h(){e.__value=n=i[13],Xe(e,e.__value),e.selected=l=i[0]===i[13]},m(r,a){C(r,e,a),m(e,s)},p(r,a){var d;a&16&&t!==(t=((d=Nt.get(r[13]))==null?void 0:d.name)+"")&&H(s,t),a&16&&n!==(n=r[13])&&(e.__value=n,Xe(e,e.__value)),a&17&&l!==(l=r[0]===r[13])&&(e.selected=l)},d(r){r&&f(e)}}}function Zt(i){let e,t=[],s=new Map,n,l=ye(i[2]);const o=r=>r[13].id;for(let r=0;r<l.length;r+=1){let a=zt(i,l,r),d=o(a);s.set(d,t[r]=Gt(d,a))}return{c(){e=w("optgroup");for(let r=0;r<t.length;r+=1)t[r].c();this.h()},l(r){e=k(r,"OPTGROUP",{label:!0});var a=b(e);for(let d=0;d<t.length;d+=1)t[d].l(a);a.forEach(f),this.h()},h(){h(e,"label",n=i[3].lessonDialogCustomTitle)},m(r,a){C(r,e,a);for(let d=0;d<t.length;d+=1)t[d]&&t[d].m(e,null)},p(r,a){a&5&&(l=ye(r[2]),t=hs(t,a,o,1,r,l,s,e,cs,Gt,null,zt)),a&8&&n!==(n=r[3].lessonDialogCustomTitle)&&h(e,"label",n)},d(r){r&&f(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function Gt(i,e){let t,s=e[13].name+"",n,l,o;return{key:i,first:null,c(){t=w("option"),n=V(s),this.h()},l(r){t=k(r,"OPTION",{});var a=b(t);n=Q(a,s),a.forEach(f),this.h()},h(){t.__value=l=e[13].id,Xe(t,t.__value),t.selected=o=e[0]===e[13].id,this.first=t},m(r,a){C(r,t,a),m(t,n)},p(r,a){e=r,a&4&&s!==(s=e[13].name+"")&&H(n,s),a&4&&l!==(l=e[13].id)&&(t.__value=l,Xe(t,t.__value)),a&5&&o!==(o=e[0]===e[13].id)&&(t.selected=o)},d(r){r&&f(t)}}}function Ft(i){let e,t,s,n,l,o,r;return t=new xt({}),{c(){e=w("button"),ue(t.$$.fragment),this.h()},l(a){e=k(a,"BUTTON",{class:!0,type:!0,title:!0});var d=b(e);fe(t.$$.fragment,d),d.forEach(f),this.h()},h(){h(e,"class","next fade-icon svelte-gbziy8"),h(e,"type","button"),e.disabled=s=i[6]===null,h(e,"title",n=i[3].seriesNextLesson),D(e,"done",i[1])},m(a,d){C(a,e,d),he(t,e,null),l=!0,o||(r=q(e,"click",i[9]),o=!0)},p(a,d){(!l||d&64&&s!==(s=a[6]===null))&&(e.disabled=s),(!l||d&8&&n!==(n=a[3].seriesNextLesson))&&h(e,"title",n),(!l||d&2)&&D(e,"done",a[1])},i(a){l||(O(t.$$.fragment,a),l=!0)},o(a){U(t.$$.fragment,a),l=!1},d(a){a&&f(e),ce(t),o=!1,r()}}}function Ms(i){let e,t,s,n,l,o,r,a,d,_,v=i[5]!==null&&Rt(i),E=i[4]!==void 0&&Ht(i),S=i[2].length!==0&&Zt(i),y=i[6]!==null&&Ft(i);return{c(){e=w("div"),v&&v.c(),t=j(),s=w("select"),E&&E.c(),n=Ve(),S&&S.c(),o=j(),r=w("div"),y&&y.c(),this.h()},l(g){e=k(g,"DIV",{class:!0});var p=b(e);v&&v.l(p),p.forEach(f),t=R(g),s=k(g,"SELECT",{title:!0,class:!0});var P=b(s);E&&E.l(P),n=Ve(),S&&S.l(P),P.forEach(f),o=R(g),r=k(g,"DIV",{class:!0});var Y=b(r);y&&y.l(Y),Y.forEach(f),this.h()},h(){h(e,"class","prev-btn svelte-gbziy8"),h(s,"title",l=i[3].seriesSelectLesson),h(s,"class","svelte-gbziy8"),h(r,"class","next-btn svelte-gbziy8")},m(g,p){C(g,e,p),v&&v.m(e,null),C(g,t,p),C(g,s,p),E&&E.m(s,null),m(s,n),S&&S.m(s,null),C(g,o,p),C(g,r,p),y&&y.m(r,null),a=!0,d||(_=[q(s,"change",i[7]),q(s,"click",Bs)],d=!0)},p(g,[p]){g[5]!==null?v?(v.p(g,p),p&32&&O(v,1)):(v=Rt(g),v.c(),O(v,1),v.m(e,null)):v&&(Ye(),U(v,1,1,()=>{v=null}),$e()),g[4]!==void 0?E?E.p(g,p):(E=Ht(g),E.c(),E.m(s,n)):E&&(E.d(1),E=null),g[2].length!==0?S?S.p(g,p):(S=Zt(g),S.c(),S.m(s,null)):S&&(S.d(1),S=null),(!a||p&8&&l!==(l=g[3].seriesSelectLesson))&&h(s,"title",l),g[6]!==null?y?(y.p(g,p),p&64&&O(y,1)):(y=Ft(g),y.c(),O(y,1),y.m(r,null)):y&&(Ye(),U(y,1,1,()=>{y=null}),$e())},i(g){a||(O(v),O(y),a=!0)},o(g){U(v),U(y),a=!1},d(g){g&&(f(e),f(t),f(s),f(o),f(r)),v&&v.d(),E&&E.d(),S&&S.d(),y&&y.d(),d=!1,dt(_)}}}const Bs=i=>i.stopPropagation();function Us(i,e,t){let{done:s}=e,{customLessons:n}=e,{lang:l}=e,{id:o}=e,r=Bt.get(o),a=r!==void 0?Ut.get(r):void 0,d=(a==null?void 0:a.prev(o))??null,_=(a==null?void 0:a.next(o))??null;const v=vs();function E(p){p.startsWith("user_")&&(t(5,d=null),t(6,_=null),t(0,o=p),v("lessonChanged",{to:p}));const P=Bt.get(p);if(P===void 0)return;const Y=Ut.get(P);Y!==void 0&&(t(4,a=Y),t(5,d=a.prev(p)),t(6,_=a.next(p)),t(0,o=p),v("lessonChanged",{to:p}))}function S(p){const P=p.target;P&&(window.confirm(l.stopMsg)?E(P.value):P.value=o)}function y(p){d!==null&&window.confirm(l.stopMsg)&&E(d)}function g(p){_!==null&&window.confirm(l.stopMsg)&&E(_)}return i.$$set=p=>{"done"in p&&t(1,s=p.done),"customLessons"in p&&t(2,n=p.customLessons),"lang"in p&&t(3,l=p.lang),"id"in p&&t(0,o=p.id)},[o,s,n,l,a,d,_,S,y,g]}class qs extends ve{constructor(e){super(),be(this,e,Us,Ms,me,{done:1,customLessons:2,lang:3,id:0})}}function Vs(i){let e,t;return{c(){e=Qe("svg"),t=Qe("rect"),this.h()},l(s){e=We(s,"svg",{viewBox:!0,xmlns:!0});var n=b(e);t=We(n,"rect",{x:!0,y:!0,width:!0,height:!0}),b(t).forEach(f),n.forEach(f),this.h()},h(){h(t,"x","130"),h(t,"y","130"),h(t,"width","240"),h(t,"height","240"),h(e,"viewBox","0 0 500 500"),h(e,"xmlns","http://www.w3.org/2000/svg")},m(s,n){C(s,e,n),m(e,t)},p:W,i:W,o:W,d(s){s&&f(e)}}}class Qs extends ve{constructor(e){super(),be(this,e,null,Vs,me,{})}}function Ws(i){let e,t;return{c(){e=Qe("svg"),t=Qe("path"),this.h()},l(s){e=We(s,"svg",{viewBox:!0,xmlns:!0});var n=b(e);t=We(n,"path",{style:!0,transform:!0,d:!0}),b(t).forEach(f),n.forEach(f),this.h()},h(){bs(t,"stroke-miterlimit","1"),h(t,"transform","matrix(1.150456, 0, 0, 1.150456, -452.353638, -416.72644)"),h(t,"d","M 596.83551429 401.342 L 624.16448571 401.342 L 636.937747652 422.253233527 A 160.44 160.44 0 0 1 660.631476318 428.093213136 L 681.659572847 415.513266212 L 705.858175267 428.2136725 L 707.450402244 452.665681037 A 160.44 160.44 0 0 1 725.716183213 468.847750915 L 750.181830832 467.48100483 L 765.70645606 489.97230738 L 755.752888061 512.36343045 A 160.44 160.44 0 0 1 764.40625104 535.180473403 L 786.704664721 545.340033214 L 789.998808211 572.469745663 L 770.77968771 587.670446813 A 160.44 160.44 0 0 1 767.838251524 611.895353276 L 782.861133419 631.253786266 L 773.170146595 656.80681844 L 749.088342485 661.334800224 A 160.44 160.44 0 0 1 735.225954716 681.417936068 L 739.531743628 705.540458533 L 719.075714783 723.662918709 L 695.648078167 716.480875069 A 160.44 160.44 0 0 1 674.040444793 727.821435899 L 666.642736372 751.181868652 L 640.107895193 757.722119601 L 622.701415286 740.475370182 A 160.44 160.44 0 0 1 598.298584714 740.475370182 L 580.892104807 757.722119601 L 554.357263628 751.181868652 L 546.959555207 727.821435899 A 160.44 160.44 0 0 1 525.351921833 716.480875069 L 501.924285217 723.662918709 L 481.468256372 705.540458533 L 485.774045284 681.417936068 A 160.44 160.44 0 0 1 471.911657515 661.334800224 L 447.829853405 656.80681844 L 438.138866581 631.253786266 L 453.161748476 611.895353276 A 160.44 160.44 0 0 1 450.22031229 587.670446813 L 431.001191789 572.469745663 L 434.295335279 545.340033214 L 456.59374896 535.180473403 A 160.44 160.44 0 0 1 465.247111939 512.36343045 L 455.29354394 489.97230738 L 470.818169168 467.48100483 L 495.283816787 468.847750915 A 160.44 160.44 0 0 1 513.549597756 452.665681037 L 515.141824733 428.2136725 L 539.340427153 415.513266212 L 560.368523682 428.093213136 A 160.44 160.44 0 0 1 584.062252348 422.253233527 Z M 610.5 500.28 A 80.22 80.22 0 0 0 610.5 660.72 A 80.22 80.22 0 0 0 610.5 500.28"),h(e,"viewBox","0 0 500 500"),h(e,"xmlns","http://www.w3.org/2000/svg")},m(s,n){C(s,e,n),m(e,t)},p:W,i:W,o:W,d(s){s&&f(e)}}}class zs extends ve{constructor(e){super(),be(this,e,null,Ws,me,{})}}class js{constructor(e,t){I(this,"word");I(this,"state");this.word=e,this.state=t}}class ft{constructor(e){I(this,"word");I(this,"input");I(this,"wordChars");I(this,"inputChars",[]);I(this,"state");I(this,"correctedErrors",0);I(this,"uncorrectedErrors",0);I(this,"keystrokes",0);I(this,"backspaces",0);I(this,"wordAttempts",0);I(this,"wordInputAttempts",[]);this.word=e,this.state=e.split("").map(t=>M.Incomplete),this.input="",this.wordChars=[...e]}getWord(){return this.word}empty(){return this.word.length===0}atEnd(){return this.inputChars.length===this.wordChars.length}reset(e){this.input.length!==0&&this.wordInputAttempts.push(this.input),this.word=e,this.wordChars=[...e],this.state=this.wordChars.map((t,s)=>s==0?M.Active:M.Incomplete),this.input="",this.wordAttempts+=1}completed(){return this.getWord()===this.input}addKeystroke(){this.keystrokes+=1}addBackspace(e){return this.keystrokes+=1,e===!0?(this.inputChars.length!==0&&(this.backspaces+=1,this.state[this.inputChars.length-1]===M.Error&&(this.correctedErrors+=1,this.uncorrectedErrors=Math.max(this.uncorrectedErrors-1,0))),this.inputChars.pop(),this.input=this.inputChars.join("").toString(),this.state=this.mapState(),!0):!1}addChar(e){if(this.input+=e,this.inputChars=[...this.input],this.state=this.mapState(),this.inputChars.length<=this.wordChars.length){const t=this.inputChars.length-1;this.inputChars[t]!==this.wordChars[t]&&(this.uncorrectedErrors+=1)}else this.uncorrectedErrors+=1}mapState(){return this.state.map((e,t)=>this.inputChars.length===t?M.Active:this.inputChars.length>t?this.wordChars[t]===this.inputChars[t]?M.Complete:M.Error:M.Incomplete)}}class rt{constructor(e,t,s,n){I(this,"config");I(this,"lesson");I(this,"stats");I(this,"lessonOptions");I(this,"word");I(this,"history");I(this,"queue");I(this,"audioQueue");this.stats=n,this.lesson=t,this.lessonOptions=s,this.word=new ft(""),this.queue=[],this.history=[],this.audioQueue=0,this.config=e,this.nextWord()}checkAudioQueue(){this.config.tts===void 0||this.config.tts.mute||(this.audioQueue-=1,this.audioQueue<=0&&(this.audioQueue=this.config.tts.queueSize,this.config.tts.play([...this.queue])))}playCurrentWord(){this.config.tts===void 0||this.config.tts.mute||this.config.tts.play(this.word.word)}fillQueue(){let e;for(;this.queue.length<this.config.minQueue&&(e=this.lesson.batch(this.config.wordBatchSize-this.queue.length))&&e.length!==0;)this.queue.push(...e)}nextWord(){let e;this.word.empty()||(e=this.word,this.history.push(new js(this.word.wordChars,this.word.state)),this.stats.add(this.word)),this.fillQueue(),this.checkAudioQueue();let t=this.queue.shift();if(t===void 0)return ae.LessonCompleted|ae.Refresh;let s=new ft(t);return s.state.length>0&&(s.state[0]=M.Active),this.word=s,[e,this.word]}}const{document:Rs}=Yt;function Jt(i,e,t){const s=i.slice();return s[39]=e[t],s}function Hs(i){let e,t;return e=new Ns({props:{stats:i[1],lang:i[2].lang}}),{c(){ue(e.$$.fragment)},l(s){fe(e.$$.fragment,s)},m(s,n){he(e,s,n),t=!0},p(s,n){const l={};n[0]&2&&(l.stats=s[1]),n[0]&4&&(l.lang=s[2].lang),e.$set(l)},i(s){t||(O(e.$$.fragment,s),t=!0)},o(s){U(e.$$.fragment,s),t=!1},d(s){ce(e,s)}}}function Ks(i){let e=i[2].lang.notStarted+"",t;return{c(){t=V(e)},l(s){t=Q(s,e)},m(s,n){C(s,t,n)},p(s,n){n[0]&4&&e!==(e=s[2].lang.notStarted+"")&&H(t,e)},i:W,o:W,d(s){s&&f(t)}}}function Zs(i){let e,t=i[4].history.length+"",s,n;return{c(){e=w("div"),s=V(t),n=V(" / ∞"),this.h()},l(l){e=k(l,"DIV",{class:!0});var o=b(e);s=Q(o,t),n=Q(o," / ∞"),o.forEach(f),this.h()},h(){h(e,"class","word-progress svelte-eaigld")},m(l,o){C(l,e,o),m(e,s),m(e,n)},p(l,o){o[0]&16&&t!==(t=l[4].history.length+"")&&H(s,t)},d(l){l&&f(e)}}}function Gs(i){let e,t=i[4].history.length+"",s,n,l=i[5].until+"",o;return{c(){e=w("div"),s=V(t),n=V(" / "),o=V(l),this.h()},l(r){e=k(r,"DIV",{class:!0});var a=b(e);s=Q(a,t),n=Q(a," / "),o=Q(a,l),a.forEach(f),this.h()},h(){h(e,"class","word-progress svelte-eaigld")},m(r,a){C(r,e,a),m(e,s),m(e,n),m(e,o)},p(r,a){a[0]&16&&t!==(t=r[4].history.length+"")&&H(s,t),a[0]&32&&l!==(l=r[5].until+"")&&H(o,l)},d(r){r&&f(e)}}}function Xt(i){let e,t,s;return t=new Ts({props:{word:i[39]}}),{c(){e=w("span"),ue(t.$$.fragment),this.h()},l(n){e=k(n,"SPAN",{class:!0}),b(e).forEach(f),fe(t.$$.fragment,n),this.h()},h(){h(e,"class","spacer")},m(n,l){C(n,e,l),he(t,n,l),s=!0},p(n,l){const o={};l[0]&16&&(o.word=n[39]),t.$set(o)},i(n){s||(O(t.$$.fragment,n),s=!0)},o(n){U(t.$$.fragment,n),s=!1},d(n){n&&f(e),ce(t,n)}}}function Fs(i){let e,t,s=i[2].lang.restartLesson+"",n,l,o;return{c(){e=w("div"),t=w("button"),n=V(s),this.h()},l(r){e=k(r,"DIV",{class:!0});var a=b(e);t=k(a,"BUTTON",{type:!0});var d=b(t);n=Q(d,s),d.forEach(f),a.forEach(f),this.h()},h(){h(t,"type","button"),h(e,"class","finished svelte-eaigld")},m(r,a){C(r,e,a),m(e,t),m(t,n),l||(o=q(t,"click",i[32]),l=!0)},p(r,a){a[0]&4&&s!==(s=r[2].lang.restartLesson+"")&&H(n,s)},d(r){r&&f(e),l=!1,o()}}}function Js(i){let e;function t(l,o){return l[7]&&!l[6]?$s:l[7]&&l[6]?Ys:Xs}let s=t(i),n=s(i);return{c(){e=w("div"),n.c(),this.h()},l(l){e=k(l,"DIV",{class:!0});var o=b(e);n.l(o),o.forEach(f),this.h()},h(){h(e,"class","tutor-bottom svelte-eaigld")},m(l,o){C(l,e,o),n.m(e,null)},p(l,o){s===(s=t(l))&&n?n.p(l,o):(n.d(1),n=s(l),n&&(n.c(),n.m(e,null)))},d(l){l&&f(e),n.d()}}}function Xs(i){let e,t,s,n;return{c(){e=w("input"),this.h()},l(l){e=k(l,"INPUT",{class:!0}),this.h()},h(){h(e,"class","tutor-input svelte-eaigld"),e.value=t=i[4].word.input},m(l,o){C(l,e,o),i[31](e),s||(n=[q(e,"blur",i[14]),q(e,"beforeinput",i[20]),q(e,"keydown",i[21]),q(e,"selectstart",it(tn)),q(e,"mousedown",it(sn)),q(e,"click",it(i[19]))],s=!0)},p(l,o){o[0]&16&&t!==(t=l[4].word.input)&&e.value!==t&&(e.value=t)},d(l){l&&f(e),i[31](null),s=!1,dt(n)}}}function Ys(i){let e,t,s,n;return{c(){e=w("input"),this.h()},l(l){e=k(l,"INPUT",{class:!0,placeholder:!0}),this.h()},h(){h(e,"class","tutor-input svelte-eaigld"),h(e,"placeholder",t=i[2].lang.inputPaused)},m(l,o){C(l,e,o),i[30](e),s||(n=q(e,"keydown",i[13]),s=!0)},p(l,o){o[0]&4&&t!==(t=l[2].lang.inputPaused)&&h(e,"placeholder",t)},d(l){l&&f(e),i[30](null),s=!1,n()}}}function $s(i){let e,t,s,n;return{c(){e=w("input"),this.h()},l(l){e=k(l,"INPUT",{class:!0,placeholder:!0}),this.h()},h(){h(e,"class","tutor-input svelte-eaigld"),h(e,"placeholder",t=i[2].lang.inputNotStarted)},m(l,o){C(l,e,o),i[29](e),s||(n=q(e,"keydown",i[12]),s=!0)},p(l,o){o[0]&4&&t!==(t=l[2].lang.inputNotStarted)&&h(e,"placeholder",t)},d(l){l&&f(e),i[29](null),s=!1,n()}}}function xs(i){let e,t,s,n,l,o,r=i[5].lang.openConfigDialog+"",a,d,_,v,E=i[2].lang.openUserStatsDialog+"",S,y,g,p,P=i[5].lang.openLessonEditDialog+"",Y,Ae,T,we,ke=i[0].baseLesson().getName(i[2].lang)+"",Le,Ie,$,K,Z,ze,re,F,je,J,x,de,Oe,Re,ee,_e,Ne,He,G,u,N,X,Pe,te,Me,ge,xe,De,et,Be,pe,tt,z,st,_t;const gt=[Ks,Hs],Ee=[];function pt(c,L){return c[6]?1:0}K=pt(i),Z=Ee[K]=gt[K](i);function mt(c,L){return c[5].until!==null?Gs:Zs}let Ze=mt(i),ne=Ze(i);de=new Es({}),_e=new zs({}),u=new Qs({});function es(c){i[27](c)}let vt={word:i[4].word.wordChars,state:i[4].word.state,active:!0};i[9]!==void 0&&(vt.span=i[9]),ge=new $t({props:vt}),qe.push(()=>Ls(ge,"span",es));let Te=ye(i[4].queue),A=[];for(let c=0;c<Te.length;c+=1)A[c]=Xt(Jt(i,Te,c));const ts=c=>U(A[c],1,1,()=>{A[c]=null});pe=new qs({props:{id:i[0].baseLesson().id,done:i[8]||!i[6],customLessons:i[3],lang:i[5].lang}}),pe.$on("lessonChanged",i[28]);function bt(c,L){return c[8]?Fs:Js}let Ge=bt(i),le=Ge(i);return{c(){e=j(),t=w("div"),s=w("header"),n=w("ul"),l=w("li"),o=w("a"),a=V(r),d=j(),_=w("li"),v=w("a"),S=V(E),y=j(),g=w("li"),p=w("a"),Y=V(P),Ae=j(),T=w("section"),we=w("h1"),Le=V(ke),Ie=j(),$=w("div"),Z.c(),ze=j(),re=w("div"),F=w("div"),ne.c(),je=j(),J=w("div"),x=w("button"),ue(de.$$.fragment),Re=j(),ee=w("button"),ue(_e.$$.fragment),He=j(),G=w("button"),ue(u.$$.fragment),Pe=j(),te=w("div"),Me=w("span"),ue(ge.$$.fragment),De=w("span");for(let c=0;c<A.length;c+=1)A[c].c();et=j(),Be=w("div"),ue(pe.$$.fragment),tt=j(),le.c(),this.h()},l(c){e=R(c),t=k(c,"DIV",{class:!0});var L=b(t);s=k(L,"HEADER",{class:!0});var ie=b(s);n=k(ie,"UL",{});var oe=b(n);l=k(oe,"LI",{});var Ce=b(l);o=k(Ce,"A",{href:!0});var B=b(o);a=Q(B,r),B.forEach(f),Ce.forEach(f),d=R(oe),_=k(oe,"LI",{});var Ke=b(_);v=k(Ke,"A",{href:!0});var wt=b(v);S=Q(wt,E),wt.forEach(f),Ke.forEach(f),y=R(oe),g=k(oe,"LI",{});var kt=b(g);p=k(kt,"A",{href:!0});var Lt=b(p);Y=Q(Lt,P),Lt.forEach(f),kt.forEach(f),oe.forEach(f),ie.forEach(f),Ae=R(L),T=k(L,"SECTION",{class:!0});var se=b(T);we=k(se,"H1",{class:!0});var Et=b(we);Le=Q(Et,ke),Et.forEach(f),Ie=R(se),$=k(se,"DIV",{class:!0});var Ct=b($);Z.l(Ct),Ct.forEach(f),ze=R(se),re=k(se,"DIV",{class:!0});var Fe=b(re);F=k(Fe,"DIV",{class:!0});var St=b(F);ne.l(St),St.forEach(f),je=R(Fe),J=k(Fe,"DIV",{class:!0});var Ue=b(J);x=k(Ue,"BUTTON",{type:!0,class:!0,title:!0});var yt=b(x);fe(de.$$.fragment,yt),yt.forEach(f),Re=R(Ue),ee=k(Ue,"BUTTON",{type:!0,class:!0,title:!0});var At=b(ee);fe(_e.$$.fragment,At),At.forEach(f),He=R(Ue),G=k(Ue,"BUTTON",{type:!0,class:!0,title:!0});var Dt=b(G);fe(u.$$.fragment,Dt),Dt.forEach(f),Ue.forEach(f),Fe.forEach(f),Pe=R(se),te=k(se,"DIV",{class:!0});var Je=b(te);Me=k(Je,"SPAN",{class:!0}),b(Me).forEach(f),fe(ge.$$.fragment,Je),De=k(Je,"SPAN",{class:!0});var Tt=b(De);for(let nt=0;nt<A.length;nt+=1)A[nt].l(Tt);Tt.forEach(f),Je.forEach(f),et=R(se),Be=k(se,"DIV",{class:!0});var It=b(Be);fe(pe.$$.fragment,It),It.forEach(f),tt=R(se),le.l(se),se.forEach(f),L.forEach(f),this.h()},h(){h(o,"href",ot+"/settings"),h(v,"href",ot+"/stats"),h(p,"href",ot+"/lessons"),h(s,"class","header"),h(we,"class","tutor-title svelte-eaigld"),h($,"class","counter svelte-eaigld"),D($,"active",!i[7]),h(F,"class","tutor-bar-left"),h(x,"type","button"),h(x,"class","fade-icon stats-btn svelte-eaigld"),h(x,"title",Oe=i[2].lang.openSessionStatsDialog),h(ee,"type","button"),h(ee,"class","fade-icon cog-button svelte-eaigld"),h(ee,"title",Ne=i[2].lang.openLessonConfigDialog),h(G,"type","button"),h(G,"class","fade-icon stop-button svelte-eaigld"),G.disabled=N=!i[6]||i[8],h(G,"title",X=i[2].lang.stop),h(J,"class","tutor-bar-right svelte-eaigld"),h(re,"class","tutor-bar svelte-eaigld"),h(Me,"class","history"),h(De,"class","queue"),h(te,"class","tutor-words svelte-eaigld"),D(te,"paused",i[7]),D(te,"char-mode",i[2].checkMode===Pt.Char),h(Be,"class","tutor-menu svelte-eaigld"),h(T,"class","svelte-eaigld"),D(T,"paused",i[7]),h(t,"class","frame")},m(c,L){C(c,e,L),C(c,t,L),m(t,s),m(s,n),m(n,l),m(l,o),m(o,a),m(n,d),m(n,_),m(_,v),m(v,S),m(n,y),m(n,g),m(g,p),m(p,Y),m(t,Ae),m(t,T),m(T,we),m(we,Le),m(T,Ie),m(T,$),Ee[K].m($,null),m(T,ze),m(T,re),m(re,F),ne.m(F,null),m(re,je),m(re,J),m(J,x),he(de,x,null),m(J,Re),m(J,ee),he(_e,ee,null),m(J,He),m(J,G),he(u,G,null),m(T,Pe),m(T,te),m(te,Me),i[26](Me),he(ge,te,null),m(te,De);for(let ie=0;ie<A.length;ie+=1)A[ie]&&A[ie].m(De,null);m(T,et),m(T,Be),he(pe,Be,null),m(T,tt),le.m(T,null),z=!0,st||(_t=[q(Rs,"keydown",i[18]),q(x,"click",i[22]),q(ee,"click",i[23]),q(G,"click",i[15])],st=!0)},p(c,L){(!z||L[0]&32)&&r!==(r=c[5].lang.openConfigDialog+"")&&H(a,r),(!z||L[0]&4)&&E!==(E=c[2].lang.openUserStatsDialog+"")&&H(S,E),(!z||L[0]&32)&&P!==(P=c[5].lang.openLessonEditDialog+"")&&H(Y,P),(!z||L[0]&5)&&ke!==(ke=c[0].baseLesson().getName(c[2].lang)+"")&&H(Le,ke);let ie=K;K=pt(c),K===ie?Ee[K].p(c,L):(Ye(),U(Ee[ie],1,1,()=>{Ee[ie]=null}),$e(),Z=Ee[K],Z?Z.p(c,L):(Z=Ee[K]=gt[K](c),Z.c()),O(Z,1),Z.m($,null)),(!z||L[0]&128)&&D($,"active",!c[7]),Ze===(Ze=mt(c))&&ne?ne.p(c,L):(ne.d(1),ne=Ze(c),ne&&(ne.c(),ne.m(F,null))),(!z||L[0]&4&&Oe!==(Oe=c[2].lang.openSessionStatsDialog))&&h(x,"title",Oe),(!z||L[0]&4&&Ne!==(Ne=c[2].lang.openLessonConfigDialog))&&h(ee,"title",Ne),(!z||L[0]&320&&N!==(N=!c[6]||c[8]))&&(G.disabled=N),(!z||L[0]&4&&X!==(X=c[2].lang.stop))&&h(G,"title",X);const oe={};if(L[0]&16&&(oe.word=c[4].word.wordChars),L[0]&16&&(oe.state=c[4].word.state),!xe&&L[0]&512&&(xe=!0,oe.span=c[9],ws(()=>xe=!1)),ge.$set(oe),L[0]&16){Te=ye(c[4].queue);let B;for(B=0;B<Te.length;B+=1){const Ke=Jt(c,Te,B);A[B]?(A[B].p(Ke,L),O(A[B],1)):(A[B]=Xt(Ke),A[B].c(),O(A[B],1),A[B].m(De,null))}for(Ye(),B=Te.length;B<A.length;B+=1)ts(B);$e()}(!z||L[0]&128)&&D(te,"paused",c[7]),(!z||L[0]&4)&&D(te,"char-mode",c[2].checkMode===Pt.Char);const Ce={};L[0]&1&&(Ce.id=c[0].baseLesson().id),L[0]&320&&(Ce.done=c[8]||!c[6]),L[0]&8&&(Ce.customLessons=c[3]),L[0]&32&&(Ce.lang=c[5].lang),pe.$set(Ce),Ge===(Ge=bt(c))&&le?le.p(c,L):(le.d(1),le=Ge(c),le&&(le.c(),le.m(T,null))),(!z||L[0]&128)&&D(T,"paused",c[7])},i(c){if(!z){O(Z),O(de.$$.fragment,c),O(_e.$$.fragment,c),O(u.$$.fragment,c),O(ge.$$.fragment,c);for(let L=0;L<Te.length;L+=1)O(A[L]);O(pe.$$.fragment,c),z=!0}},o(c){U(Z),U(de.$$.fragment,c),U(_e.$$.fragment,c),U(u.$$.fragment,c),U(ge.$$.fragment,c),A=A.filter(Boolean);for(let L=0;L<A.length;L+=1)U(A[L]);U(pe.$$.fragment,c),z=!1},d(c){c&&(f(e),f(t)),Ee[K].d(),ne.d(),ce(de),ce(_e),ce(u),i[26](null),ce(ge),ct(A,c),ce(pe),le.d(),st=!1,dt(_t)}}}function en(i){let e;for(;e=i.firstChild;)i.removeChild(e)}const tn=()=>{},sn=()=>{};function nn(i,e,t){let{db:s}=e,{originalConfig:n}=e,{lesson:l}=e,{lessonOpts:o}=e,{lessonStats:r}=e,{customLessons:a}=e,d=n.mergeLessonOptions(o).mergeAvailable(l.overrides()),_=new rt(d,l,o,r),v=!1,E=!0,S=!1,y,g,p;ht(async()=>{document.addEventListener("click",P),document.addEventListener("touchstart",P),g&&(t(6,v=!1),await lt(),g.focus()),Se.saveLast(l,n,s)});function P(u){g==null||g.focus()}async function Y(u){if("key"in u){if(u.key==="Tab"||u.key==="Alt"||u.key==="Shift"||u.key==="Control"||u.key.substring(0,5)==="Arrow")return;if(u.key===d.shortcuts.pause){u.preventDefault();return}}t(6,v=!0),Ae()}async function Ae(u=void 0){g!==void 0&&(t(7,E=!1),r.resume(),await lt(),g.focus(),u!==void 0&&F(l.handleKeydown(u,d,_.word,r)))}function T(u){g!==void 0&&(t(7,E=!0),_.word.atEnd()&&_.word.word===_.word.input&&F(ae.NextWord&ae.Refresh),r.pause())}async function we(){Ie()}function ke(){window.confirm(d.lang.stopMsg)&&Ie()}async function Le(u){const N=l.baseLesson().id;u===void 0&&(u={}),t(5,d=n.mergeLessonOptions(u)),t(24,o=u),t(0,l=await Se.load(N,d,s)),t(4,_=new rt(n,l,u,r)),t(6,v=!1),t(7,E=!0),t(8,S=!1),t(1,r=new ut(N,d.checkMode)),en(p)}async function Ie(){if(t(7,E=!0),r.pause(),t(1,r),r.chars===0||!n.logStats){t(8,S=!0);return}const u=await us(s,Mt,l.baseLesson().id);await ds(n,s,r).then(N=>{if(N===!0){n.userStats.add(r),n.saveUserConfig(s);const X=Se.getClass(l,os);X!==null&&X.saveTypos(s,l.baseLesson().id);const Pe=u||{lesson_id:l.baseLesson().id,entries:[]};Pe.entries.push(r.baseStats()),fs(s,Mt,Pe)}}),t(8,S=!0)}async function $(u){const N=u.to;t(0,l=await Se.load(N,n,s)),Se.saveLast(l,n,s),t(4,_=new rt(n,l,o,r)),t(6,v=!1),t(7,E=!0),t(8,S=!1),t(1,r=new ut(N,d.checkMode))}async function K(u){u.key===d.shortcuts.pause||u.key==="Escape"?(E?(Ae(),g==null||g.focus()):T(),v||t(6,v=!0),u.preventDefault()):u.key===d.shortcuts.stop&&v&&(u.preventDefault(),T(),ke())}function Z(u){g==null||g.focus()}function ze(u){F(l.handleInput(u,d,_.word,r))}function re(u){F(l.handleKeydown(u,d,_.word,r))}function F(u,N=void 0){if(u!==0){if(u&ae.LessonCompleted&&(_.word.empty()||J(_.word,p),t(4,_.word=new ft(""),_),we()),u&ae.NextWord){const X=_.nextWord();if(!Array.isArray(X)){X&ae.NextWord||F(X);return}X[0]!==void 0&&(J(X[0],p),N===void 0&&(u&ae.MissedSpace||_s(n.lang,p)))}if(u&ae.MissedSpace&&gs(n.lang,p),u&ae.Refresh){t(4,_);return}}}async function je(){await lt(),y&&y.scrollIntoView({behavior:"smooth"})}function J(u,N){new $t({target:N,props:{word:u.wordChars,state:u.state}})}async function x(){ps(n.lang.statsDialogSessionTitle,n,s,r)}async function de(){const u=await ms(n,s,l,o,d.lang.lessonConfigConfirmSubmit);if(u!==void 0){let N;t(0,[l,N]=u,l),Se.saveLessonOptions(l.baseLesson().id,N,s),Le(N)}}function Oe(u){qe[u?"unshift":"push"](()=>{p=u,t(11,p)})}function Re(u){y=u,t(9,y)}const ee=u=>$(u.detail);function _e(u){qe[u?"unshift":"push"](()=>{g=u,t(10,g)})}function Ne(u){qe[u?"unshift":"push"](()=>{g=u,t(10,g)})}function He(u){qe[u?"unshift":"push"](()=>{g=u,t(10,g)})}const G=()=>Le();return i.$$set=u=>{"db"in u&&t(25,s=u.db),"originalConfig"in u&&t(2,n=u.originalConfig),"lesson"in u&&t(0,l=u.lesson),"lessonOpts"in u&&t(24,o=u.lessonOpts),"lessonStats"in u&&t(1,r=u.lessonStats),"customLessons"in u&&t(3,a=u.customLessons)},i.$$.update=()=>{i.$$.dirty[0]&16&&(_.word.word,je())},[l,r,n,a,_,d,v,E,S,y,g,p,Y,Ae,T,ke,Le,$,K,Z,ze,re,x,de,o,s,Oe,Re,ee,_e,Ne,He,G]}class ln extends ve{constructor(e){super(),be(this,e,nn,xs,me,{db:25,originalConfig:2,lesson:0,lessonOpts:24,lessonStats:1,customLessons:3},null,[-1,-1])}}const{document:at}=Yt;function on(i){let e,t,s,n;return at.title=e=i[1].lang.tutorTitle,s=new ln({props:{originalConfig:i[1],lesson:i[2],lessonStats:i[4],db:i[0],lessonOpts:i[3],customLessons:i[5]}}),{c(){t=j(),ue(s.$$.fragment)},l(l){ks("svelte-1ybfzi4",at.head).forEach(f),t=R(l),fe(s.$$.fragment,l)},m(l,o){C(l,t,o),he(s,l,o),n=!0},p(l,[o]){(!n||o&2)&&e!==(e=l[1].lang.tutorTitle)&&(at.title=e)},i(l){n||(O(s.$$.fragment,l),n=!0)},o(l){U(s.$$.fragment,l),n=!1},d(l){l&&f(t),ce(s,l)}}}function rn(i,e,t){let{data:s}=e,n=s.db,l=s.config,o=s.lesson,r=s.lessonOpts,a=new ut(o.baseLesson().id,l.checkMode),d=s.customLessons;return ht(()=>{document.documentElement.lang=l.lang.lang,document.documentElement.dir=l.lang.textDirection}),i.$$set=_=>{"data"in _&&t(6,s=_.data)},[n,l,o,r,a,d,s]}class vn extends ve{constructor(e){super(),be(this,e,rn,on,me,{data:6})}}export{vn as component,mn as universal};
